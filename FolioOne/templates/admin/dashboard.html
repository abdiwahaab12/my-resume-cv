<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Portfolio</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        .sidebar {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .sidebar .nav-link {
            color: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            margin: 5px 0;
        }
        .sidebar .nav-link:hover, .sidebar .nav-link.active {
            color: white;
            background: rgba(255, 255, 255, 0.1);
        }
        .main-content {
            background: #f8f9fa;
            min-height: 100vh;
        }
        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border: none;
        }
        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }
        .table-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3 col-lg-2 px-0">
                <div class="sidebar p-3">
                    <div class="text-center mb-4">
                        <h4 class="text-white"><i class="bi bi-shield-lock me-2"></i>Admin Panel</h4>
                        <small class="text-white-50">Welcome, {{ session.admin_user }}</small>
                    </div>
                    
                    <nav class="nav flex-column">
                        <a class="nav-link active" href="#dashboard" data-bs-toggle="tab">
                            <i class="bi bi-speedometer2 me-2"></i>Dashboard
                        </a>
                        <a class="nav-link" href="#projects" data-bs-toggle="tab">
                            <i class="bi bi-folder me-2"></i>Projects
                        </a>
                        <a class="nav-link" href="#skills" data-bs-toggle="tab">
                            <i class="bi bi-gear me-2"></i>Skills
                        </a>
                        <a class="nav-link" href="#experience" data-bs-toggle="tab">
                            <i class="bi bi-briefcase me-2"></i>Experience
                        </a>
                        <a class="nav-link" href="#contacts" data-bs-toggle="tab">
                            <i class="bi bi-envelope me-2"></i>Messages
                        </a>
                        <hr class="text-white-50">
                        <a class="nav-link" href="{{ url_for('index') }}" target="_blank">
                            <i class="bi bi-eye me-2"></i>View Site
                        </a>
                        <a class="nav-link" href="{{ url_for('admin_logout') }}">
                            <i class="bi bi-box-arrow-right me-2"></i>Logout
                        </a>
                    </nav>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="col-md-9 col-lg-10">
                <div class="main-content p-4">
                    <div class="tab-content">
                        <!-- Dashboard Tab -->
                        <div class="tab-pane fade show active" id="dashboard">
                            <h2 class="mb-4">Dashboard Overview</h2>
                            
                            <!-- Stats Cards -->
                            <div class="row g-4 mb-4">
                                <div class="col-md-3">
                                    <div class="stat-card">
                                        <div class="d-flex align-items-center">
                                            <div class="stat-icon bg-primary me-3">
                                                <i class="bi bi-folder"></i>
                                            </div>
                                            <div>
                                                <h3 class="mb-0">{{ projects_count }}</h3>
                                                <small class="text-muted">Total Projects</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stat-card">
                                        <div class="d-flex align-items-center">
                                            <div class="stat-icon bg-success me-3">
                                                <i class="bi bi-gear"></i>
                                            </div>
                                            <div>
                                                <h3 class="mb-0">{{ skills_count }}</h3>
                                                <small class="text-muted">Skills</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stat-card">
                                        <div class="d-flex align-items-center">
                                            <div class="stat-icon bg-warning me-3">
                                                <i class="bi bi-briefcase"></i>
                                            </div>
                                            <div>
                                                <h3 class="mb-0">{{ experiences_count }}</h3>
                                                <small class="text-muted">Experience</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stat-card">
                                        <div class="d-flex align-items-center">
                                            <div class="stat-icon bg-info me-3">
                                                <i class="bi bi-envelope"></i>
                                            </div>
                                            <div>
                                                <h3 class="mb-0">{{ contacts_count }}</h3>
                                                <small class="text-muted">Messages</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Recent Activity -->
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="table-card p-3">
                                        <h5 class="mb-3">Recent Projects</h5>
                                        {% if recent_projects %}
                                        <div class="list-group list-group-flush">
                                            {% for project in recent_projects %}
                                            <div class="list-group-item d-flex justify-content-between align-items-center">
                                                <div>
                                                    <h6 class="mb-1">{{ project.title }}</h6>
                                                    <small class="text-muted">{{ project.category }}</small>
                                                </div>
                                                <small class="text-muted">{{ project.created_at.strftime('%m/%d/%Y') }}</small>
                                            </div>
                                            {% endfor %}
                                        </div>
                                        {% else %}
                                        <p class="text-muted">No projects yet.</p>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="table-card p-3">
                                        <h5 class="mb-3">Recent Messages</h5>
                                        {% if recent_contacts %}
                                        <div class="list-group list-group-flush">
                                            {% for contact in recent_contacts %}
                                            <div class="list-group-item d-flex justify-content-between align-items-center">
                                                <div>
                                                    <h6 class="mb-1">{{ contact.name }}</h6>
                                                    <small class="text-muted">{{ contact.subject or 'No subject' }}</small>
                                                </div>
                                                <small class="text-muted">{{ contact.created_at.strftime('%m/%d/%Y') }}</small>
                                            </div>
                                            {% endfor %}
                                        </div>
                                        {% else %}
                                        <p class="text-muted">No messages yet.</p>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Projects Tab -->
                        <div class="tab-pane fade" id="projects">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h2>Projects Management</h2>
                                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#projectModal">
                                    <i class="bi bi-plus me-2"></i>Add Project
                                </button>
                            </div>
                            
                            <div class="table-card p-3">
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Image</th>
                                                <th>Title</th>
                                                <th>Category</th>
                                                <th>Featured</th>
                                                <th>Created</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="projectsTable">
                                            <!-- Projects will be loaded here via AJAX -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Skills Tab -->
                        <div class="tab-pane fade" id="skills">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h2>Skills Management</h2>
                                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#skillModal">
                                    <i class="bi bi-plus me-2"></i>Add Skill
                                </button>
                            </div>
                            
                            <div class="table-card p-3">
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Skill Name</th>
                                                <th>Category</th>
                                                <th>Proficiency</th>
                                                <th>Description</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="skillsTable">
                                            <!-- Skills will be loaded here via AJAX -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Experience Tab -->
                        <div class="tab-pane fade" id="experience">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h2>Experience Management</h2>
                                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#experienceModal">
                                    <i class="bi bi-plus me-2"></i>Add Experience
                                </button>
                            </div>
                            
                            <div class="table-card p-3">
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Title</th>
                                                <th>Company</th>
                                                <th>Start Date</th>
                                                <th>End Date</th>
                                                <th>Current</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="experienceTable">
                                            <!-- Experience will be loaded here via AJAX -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Contacts Tab -->
                        <div class="tab-pane fade" id="contacts">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h2>Contact Messages</h2>
                                <button class="btn btn-outline-danger" onclick="clearAllMessages()">
                                    <i class="bi bi-trash me-2"></i>Clear All
                                </button>
                            </div>
                            
                            <div class="table-card p-3">
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Name</th>
                                                <th>Email</th>
                                                <th>Subject</th>
                                                <th>Message</th>
                                                <th>Date</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="messagesTable">
                                            <!-- Messages will be loaded here via AJAX -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Project Modal -->
    <div class="modal fade" id="projectModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Project</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="projectForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Title</label>
                                <input type="text" class="form-control" name="title" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Category</label>
                                <select class="form-select" name="category" required>
                                    <option value="">Select Category</option>
                                    <option value="Web Development">Web Development</option>
                                    <option value="Mobile App">Mobile App</option>
                                    <option value="UI/UX Design">UI/UX Design</option>
                                    <option value="Data Science">Data Science</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" name="description" rows="3" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Long Description</label>
                            <textarea class="form-control" name="long_description" rows="4"></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Project URL</label>
                                <input type="url" class="form-control" name="project_url">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">GitHub URL</label>
                                <input type="url" class="form-control" name="github_url">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Main Project Image (Thumbnail)</label>
                            <input type="file" class="form-control" id="projectImage" accept="image/*" onchange="uploadImage()">
                            <small class="form-text text-muted">Upload the main project image (will be used as thumbnail)</small>
                            <input type="hidden" name="image_url" id="imageUrl">
                            <div id="imagePreview" class="mt-2" style="display: none;">
                                <img id="previewImg" src="" alt="Preview" class="img-thumbnail" style="max-width: 200px; max-height: 200px;">
                                <div class="mt-1">
                                    <small class="text-success" id="uploadStatus"></small>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Gallery Images (Multiple Screenshots)</label>
                            <input type="file" class="form-control" id="galleryImages" accept="image/*" multiple onchange="uploadGalleryImages()">
                            <small class="form-text text-muted">Upload multiple screenshots (up to 5 images)</small>
                            <input type="hidden" name="gallery_images" id="galleryImagesList">
                            <div id="galleryPreview" class="mt-2" style="display: none;">
                                <div class="row" id="galleryImagesContainer">
                                    <!-- Gallery images will be displayed here -->
                                </div>
                                <div class="mt-1">
                                    <small class="text-success" id="galleryUploadStatus"></small>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Technologies (comma-separated)</label>
                            <input type="text" class="form-control" name="technologies" placeholder="React, Node.js, MongoDB">
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="featured" id="featured">
                                <label class="form-check-label" for="featured">Featured Project</label>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveProject()">Save Project</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Experience Modal -->
    <div class="modal fade" id="experienceModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Experience</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="experienceForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Job Title</label>
                                <input type="text" class="form-control" name="title" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Company</label>
                                <input type="text" class="form-control" name="company" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Start Date</label>
                                <input type="date" class="form-control" name="start_date" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">End Date</label>
                                <input type="date" class="form-control" name="end_date" id="endDate">
                                <div class="form-check mt-2">
                                    <input class="form-check-input" type="checkbox" id="currentJob" onchange="toggleEndDate()">
                                    <label class="form-check-label" for="currentJob">Currently Working Here</label>
                                </div>
                            </div>
                            <div class="col-12 mb-3">
                                <label class="form-label">Description</label>
                                <textarea class="form-control" name="description" rows="3" placeholder="Brief description of your role and responsibilities"></textarea>
                            </div>
                            <div class="col-12 mb-3">
                                <label class="form-label">Achievements (One per line)</label>
                                <textarea class="form-control" name="achievements" rows="4" placeholder="Enter each achievement on a new line"></textarea>
                                <small class="form-text text-muted">Each line will be treated as a separate achievement</small>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveExperience()">Save Experience</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Skills Modal -->
    <div class="modal fade" id="skillModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Skill</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="skillForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Skill Name</label>
                                <input type="text" class="form-control" name="name" required placeholder="e.g., Python, JavaScript, Photoshop">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Category</label>
                                <select class="form-select" name="category" required>
                                    <option value="">Select Category</option>
                                    <option value="Programming Languages">Programming Languages</option>
                                    <option value="Web Development">Web Development</option>
                                    <option value="Mobile Development">Mobile Development</option>
                                    <option value="Design">Design</option>
                                    <option value="Database">Database</option>
                                    <option value="Tools & Software">Tools & Software</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Proficiency Level</label>
                                <select class="form-select" name="proficiency" required>
                                    <option value="">Select Level</option>
                                    <option value="25">Beginner (25%)</option>
                                    <option value="50">Intermediate (50%)</option>
                                    <option value="75">Advanced (75%)</option>
                                    <option value="90">Expert (90%)</option>
                                    <option value="100">Master (100%)</option>
                                </select>
                            </div>
                            <div class="col-12 mb-3">
                                <label class="form-label">Description (Optional)</label>
                                <textarea class="form-control" name="description" rows="3" placeholder="Brief description of your experience with this skill"></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveSkill()">Save Skill</button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Load projects when projects tab is clicked
        document.querySelector('a[href="#projects"]').addEventListener('click', function() {
            loadProjects();
        });
        
        // Clear form when project modal is hidden
        document.getElementById('projectModal').addEventListener('hidden.bs.modal', function() {
            const form = document.getElementById('projectForm');
            form.reset();
            document.getElementById('imagePreview').style.display = 'none';
            document.getElementById('imageUrl').value = '';
        });
        
        // Load messages when contacts tab is clicked
        document.querySelector('a[href="#contacts"]').addEventListener('click', function() {
            loadMessages();
        });
        
        // Load experience when experience tab is clicked
        document.querySelector('a[href="#experience"]').addEventListener('click', function() {
            loadExperience();
        });
        
        // Load skills when skills tab is clicked
        document.querySelector('a[href="#skills"]').addEventListener('click', function() {
            loadSkills();
        });
        
        function loadProjects() {
            fetch('/api/projects')
                .then(response => response.json())
                .then(projects => {
                    const tbody = document.getElementById('projectsTable');
                    tbody.innerHTML = projects.map(project => `
                        <tr>
                            <td>
                                ${project.image_url ? 
                                    `<img src="/uploads/${project.image_url}" alt="${project.title}" class="img-thumbnail" style="width: 50px; height: 50px; object-fit: cover;">` : 
                                    '<div class="bg-light d-flex align-items-center justify-content-center" style="width: 50px; height: 50px;"><i class="bi bi-image text-muted"></i></div>'
                                }
                            </td>
                            <td>${project.title}</td>
                            <td><span class="badge bg-secondary">${project.category}</span></td>
                            <td>${project.featured ? '<i class="bi bi-star-fill text-warning"></i>' : '<i class="bi bi-star text-muted"></i>'}</td>
                            <td>${new Date(project.created_at).toLocaleDateString()}</td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary me-1" onclick="editProject(${project.id})">
                                    <i class="bi bi-pencil"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger" onclick="deleteProject(${project.id})">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `).join('');
                })
                .catch(error => console.error('Error loading projects:', error));
        }
        
        function uploadImage() {
            const fileInput = document.getElementById('projectImage');
            const file = fileInput.files[0];
            const preview = document.getElementById('imagePreview');
            const previewImg = document.getElementById('previewImg');
            const uploadStatus = document.getElementById('uploadStatus');
            
            if (file) {
                // Show preview immediately
                const reader = new FileReader();
                reader.onload = function(e) {
                    previewImg.src = e.target.result;
                    preview.style.display = 'block';
                    uploadStatus.textContent = 'Uploading...';
                };
                reader.readAsDataURL(file);
                
                const formData = new FormData();
                formData.append('file', file);
                
                fetch('/api/upload', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(result => {
                    if (result.filename) {
                        document.getElementById('imageUrl').value = result.filename;
                        uploadStatus.textContent = '✅ Image uploaded successfully!';
                        uploadStatus.className = 'text-success';
                    } else {
                        uploadStatus.textContent = '❌ Error uploading image: ' + (result.error || 'Unknown error');
                        uploadStatus.className = 'text-danger';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    uploadStatus.textContent = '❌ Error uploading image';
                    uploadStatus.className = 'text-danger';
                });
            } else {
                preview.style.display = 'none';
            }
        }
        
        function uploadGalleryImages() {
            const fileInput = document.getElementById('galleryImages');
            const files = fileInput.files;
            const preview = document.getElementById('galleryPreview');
            const container = document.getElementById('galleryImagesContainer');
            const status = document.getElementById('galleryUploadStatus');
            const hiddenInput = document.getElementById('galleryImagesList');
            
            if (files.length > 0) {
                if (files.length > 5) {
                    status.textContent = '❌ Maximum 5 images allowed';
                    status.className = 'text-danger';
                    return;
                }
                
                preview.style.display = 'block';
                container.innerHTML = '';
                status.textContent = 'Uploading...';
                status.className = 'text-info';
                
                const uploadPromises = Array.from(files).map(file => {
                    const formData = new FormData();
                    formData.append('file', file);
                    
                    return fetch('/api/upload', {
                        method: 'POST',
                        body: formData
                    })
                    .then(response => response.json())
                    .then(result => {
                        if (result.filename) {
                            return result.filename;
                        } else {
                            throw new Error(result.error || 'Upload failed');
                        }
                    });
                });
                
                Promise.all(uploadPromises)
                .then(filenames => {
                    hiddenInput.value = JSON.stringify(filenames);
                    status.textContent = `✅ ${filenames.length} images uploaded successfully!`;
                    status.className = 'text-success';
                    
                    // Display preview images
                    filenames.forEach(filename => {
                        const col = document.createElement('div');
                        col.className = 'col-md-3 mb-2';
                        col.innerHTML = `
                            <img src="/uploads/${filename}" alt="Gallery Preview" class="img-thumbnail" style="width: 100%; height: 100px; object-fit: cover;">
                        `;
                        container.appendChild(col);
                    });
                })
                .catch(error => {
                    console.error('Error:', error);
                    status.textContent = '❌ Error uploading images: ' + error.message;
                    status.className = 'text-danger';
                });
            } else {
                preview.style.display = 'none';
            }
        }
        
        function saveProject() {
            const form = document.getElementById('projectForm');
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
            
            // Convert technologies string to array
            if (data.technologies) {
                data.technologies = data.technologies.split(',').map(tech => tech.trim()).filter(tech => tech);
            }
            
            // Convert gallery images string to array
            if (data.gallery_images) {
                try {
                    data.gallery_images = JSON.parse(data.gallery_images);
                } catch (e) {
                    data.gallery_images = [];
                }
            }
            
            // Convert featured checkbox to boolean
            data.featured = formData.has('featured');
            
            fetch('/api/projects', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                if (result.message) {
                    alert('Project saved successfully!');
                    bootstrap.Modal.getInstance(document.getElementById('projectModal')).hide();
                    form.reset();
                    loadProjects();
                } else {
                    alert('Error saving project: ' + (result.error || 'Unknown error'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error saving project');
            });
        }
        
        function deleteProject(id) {
            if (confirm('Are you sure you want to delete this project?')) {
                fetch(`/api/projects/${id}`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(result => {
                    if (result.message) {
                        alert('Project deleted successfully!');
                        loadProjects();
                    } else {
                        alert('Error deleting project: ' + (result.error || 'Unknown error'));
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error deleting project');
                });
            }
        }
        
        function loadMessages() {
            fetch('/api/messages')
                .then(response => response.json())
                .then(messages => {
                    const tbody = document.getElementById('messagesTable');
                    if (messages.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="6" class="text-center text-muted">No messages yet</td></tr>';
                    } else {
                        tbody.innerHTML = messages.map(message => `
                            <tr>
                                <td><strong>${message.name}</strong></td>
                                <td><a href="mailto:${message.email}">${message.email}</a></td>
                                <td>${message.subject || 'No Subject'}</td>
                                <td>${message.message.length > 50 ? message.message.substring(0, 50) + '...' : message.message}</td>
                                <td>${new Date(message.created_at).toLocaleDateString()}</td>
                                <td>
                                    <button class="btn btn-sm btn-outline-primary me-1" onclick="viewMessage(${message.id})" title="View Full Message">
                                        <i class="bi bi-eye"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger" onclick="deleteMessage(${message.id})" title="Delete Message">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        `).join('');
                    }
                })
                .catch(error => {
                    console.error('Error loading messages:', error);
                    document.getElementById('messagesTable').innerHTML = '<tr><td colspan="6" class="text-center text-danger">Error loading messages</td></tr>';
                });
        }
        
        function viewMessage(id) {
            fetch(`/api/messages/${id}`)
                .then(response => response.json())
                .then(message => {
                    alert(`From: ${message.name} (${message.email})\nSubject: ${message.subject || 'No Subject'}\n\nMessage:\n${message.message}`);
                })
                .catch(error => {
                    console.error('Error loading message:', error);
                    alert('Error loading message');
                });
        }
        
        function deleteMessage(id) {
            if (confirm('Are you sure you want to delete this message?')) {
                fetch(`/api/messages/${id}`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(result => {
                    if (result.message) {
                        alert('Message deleted successfully!');
                        loadMessages();
                    } else {
                        alert('Error deleting message: ' + (result.error || 'Unknown error'));
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error deleting message');
                });
            }
        }
        
        function clearAllMessages() {
            if (confirm('Are you sure you want to delete ALL messages? This action cannot be undone.')) {
                fetch('/api/messages', {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(result => {
                    if (result.message) {
                        alert('All messages deleted successfully!');
                        loadMessages();
                    } else {
                        alert('Error clearing messages: ' + (result.error || 'Unknown error'));
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error clearing messages');
                });
            }
        }
        
        function toggleEndDate() {
            const currentJob = document.getElementById('currentJob');
            const endDate = document.getElementById('endDate');
            
            if (currentJob.checked) {
                endDate.disabled = true;
                endDate.value = '';
            } else {
                endDate.disabled = false;
            }
        }
        
        function loadExperience() {
            fetch('/api/experiences')
                .then(response => response.json())
                .then(experiences => {
                    const tbody = document.getElementById('experienceTable');
                    if (experiences.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="6" class="text-center text-muted">No experience entries yet</td></tr>';
                    } else {
                        tbody.innerHTML = experiences.map(exp => `
                            <tr>
                                <td><strong>${exp.title}</strong></td>
                                <td>${exp.company}</td>
                                <td>${new Date(exp.start_date).toLocaleDateString()}</td>
                                <td>${exp.end_date ? new Date(exp.end_date).toLocaleDateString() : 'Present'}</td>
                                <td>${exp.end_date ? '<i class="bi bi-x-circle text-muted"></i>' : '<i class="bi bi-check-circle text-success"></i>'}</td>
                                <td>
                                    <button class="btn btn-sm btn-outline-primary me-1" onclick="editExperience(${exp.id})" title="Edit Experience">
                                        <i class="bi bi-pencil"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger" onclick="deleteExperience(${exp.id})" title="Delete Experience">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        `).join('');
                    }
                })
                .catch(error => {
                    console.error('Error loading experience:', error);
                    document.getElementById('experienceTable').innerHTML = '<tr><td colspan="6" class="text-center text-danger">Error loading experience</td></tr>';
                });
        }
        
        function saveExperience() {
            const form = document.getElementById('experienceForm');
            const formData = new FormData(form);
            
            // Convert achievements textarea to JSON array
            const achievementsText = formData.get('achievements');
            const achievements = achievementsText ? achievementsText.split('\n').filter(line => line.trim()) : [];
            formData.set('achievements', JSON.stringify(achievements));
            
            // If current job is checked, set end_date to null
            if (document.getElementById('currentJob').checked) {
                formData.set('end_date', '');
            }
            
            fetch('/api/experiences', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(result => {
                if (result.message) {
                    alert('Experience saved successfully!');
                    bootstrap.Modal.getInstance(document.getElementById('experienceModal')).hide();
                    form.reset();
                    loadExperience();
                } else {
                    alert('Error saving experience: ' + (result.error || 'Unknown error'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error saving experience');
            });
        }
        
        function editExperience(id) {
            fetch(`/api/experiences/${id}`)
                .then(response => response.json())
                .then(experience => {
                    // Populate form with existing data
                    document.querySelector('#experienceForm input[name="title"]').value = experience.title;
                    document.querySelector('#experienceForm input[name="company"]').value = experience.company;
                    document.querySelector('#experienceForm input[name="start_date"]').value = experience.start_date;
                    document.querySelector('#experienceForm input[name="end_date"]').value = experience.end_date || '';
                    document.querySelector('#experienceForm textarea[name="description"]').value = experience.description || '';
                    
                    // Handle achievements
                    const achievements = experience.achievements ? JSON.parse(experience.achievements) : [];
                    document.querySelector('#experienceForm textarea[name="achievements"]').value = achievements.join('\n');
                    
                    // Handle current job checkbox
                    const currentJob = !experience.end_date;
                    document.getElementById('currentJob').checked = currentJob;
                    toggleEndDate();
                    
                    // Change modal title and add hidden field for ID
                    document.querySelector('#experienceModal .modal-title').textContent = 'Edit Experience';
                    let hiddenId = document.querySelector('#experienceForm input[name="id"]');
                    if (!hiddenId) {
                        hiddenId = document.createElement('input');
                        hiddenId.type = 'hidden';
                        hiddenId.name = 'id';
                        document.getElementById('experienceForm').appendChild(hiddenId);
                    }
                    hiddenId.value = id;
                    
                    // Show modal
                    new bootstrap.Modal(document.getElementById('experienceModal')).show();
                })
                .catch(error => {
                    console.error('Error loading experience:', error);
                    alert('Error loading experience');
                });
        }
        
        function deleteExperience(id) {
            if (confirm('Are you sure you want to delete this experience entry?')) {
                fetch(`/api/experiences/${id}`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(result => {
                    if (result.message) {
                        alert('Experience deleted successfully!');
                        loadExperience();
                    } else {
                        alert('Error deleting experience: ' + (result.error || 'Unknown error'));
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error deleting experience');
                });
            }
        }
        
        function loadSkills() {
            fetch('/api/skills')
                .then(response => response.json())
                .then(skills => {
                    const tbody = document.getElementById('skillsTable');
                    if (skills.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="5" class="text-center text-muted">No skills added yet</td></tr>';
                    } else {
                        tbody.innerHTML = skills.map(skill => `
                            <tr>
                                <td><strong>${skill.name}</strong></td>
                                <td><span class="badge bg-secondary">${skill.category}</span></td>
                                <td>
                                    <div class="progress" style="height: 20px;">
                                        <div class="progress-bar" role="progressbar" style="width: ${skill.proficiency}%" aria-valuenow="${skill.proficiency}" aria-valuemin="0" aria-valuemax="100">
                                            ${skill.proficiency}%
                                        </div>
                                    </div>
                                </td>
                                <td>${skill.description || 'No description'}</td>
                                <td>
                                    <button class="btn btn-sm btn-outline-primary me-1" onclick="editSkill(${skill.id})" title="Edit Skill">
                                        <i class="bi bi-pencil"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger" onclick="deleteSkill(${skill.id})" title="Delete Skill">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        `).join('');
                    }
                })
                .catch(error => {
                    console.error('Error loading skills:', error);
                    document.getElementById('skillsTable').innerHTML = '<tr><td colspan="5" class="text-center text-danger">Error loading skills</td></tr>';
                });
        }
        
        function saveSkill() {
            const form = document.getElementById('skillForm');
            const formData = new FormData(form);
            
            fetch('/api/skills', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(result => {
                if (result.message) {
                    alert('Skill saved successfully!');
                    bootstrap.Modal.getInstance(document.getElementById('skillModal')).hide();
                    form.reset();
                    loadSkills();
                } else {
                    alert('Error saving skill: ' + (result.error || 'Unknown error'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error saving skill');
            });
        }
        
        function editSkill(id) {
            fetch(`/api/skills/${id}`)
                .then(response => response.json())
                .then(skill => {
                    // Populate form with existing data
                    document.querySelector('#skillForm input[name="name"]').value = skill.name;
                    document.querySelector('#skillForm select[name="category"]').value = skill.category;
                    document.querySelector('#skillForm select[name="proficiency"]').value = skill.proficiency;
                    document.querySelector('#skillForm textarea[name="description"]').value = skill.description || '';
                    
                    // Change modal title and add hidden field for ID
                    document.querySelector('#skillModal .modal-title').textContent = 'Edit Skill';
                    let hiddenId = document.querySelector('#skillForm input[name="id"]');
                    if (!hiddenId) {
                        hiddenId = document.createElement('input');
                        hiddenId.type = 'hidden';
                        hiddenId.name = 'id';
                        document.getElementById('skillForm').appendChild(hiddenId);
                    }
                    hiddenId.value = id;
                    
                    // Show modal
                    new bootstrap.Modal(document.getElementById('skillModal')).show();
                })
                .catch(error => {
                    console.error('Error loading skill:', error);
                    alert('Error loading skill');
                });
        }
        
        function deleteSkill(id) {
            if (confirm('Are you sure you want to delete this skill?')) {
                fetch(`/api/skills/${id}`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(result => {
                    if (result.message) {
                        alert('Skill deleted successfully!');
                        loadSkills();
                    } else {
                        alert('Error deleting skill: ' + (result.error || 'Unknown error'));
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error deleting skill');
                });
            }
        }
    </script>
</body>
</html>
